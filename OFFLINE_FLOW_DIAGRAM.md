# Offline Mode - Flow Diagrams

## Application Startup Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    APPLICATION START                        │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              Validate Configuration                         │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│         Initialize File Monitor (No Internet Needed)        │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              Check Internet Connection                      │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────┴───────┐
                    ↓               ↓
            ┌──────────────┐  ┌──────────────┐
            │  INTERNET    │  │   NO INTERNET│
            │  AVAILABLE   │  │              │
            └──────────────┘  └──────────────┘
                    ↓               ↓
                    │         ┌─────────────────┐
                    │         │ Wait for Internet│
                    │         │ (Check every 10s)│
                    │         └────────┬────────┘
                    │                  ↓
                    │         ┌─────────────────┐
                    │         │ Internet Found? │
                    │         └────────┬────────┘
                    │                  │
                    │         ┌────────┴────────┐
                    │         ↓                 ↓
                    │      YES              NO (loop)
                    │         │
                    └─────────┬─────────┘
                              ↓
        ┌─────────────────────────────────────────┐
        │ Authenticate with Google Calendar       │
        │ (with retry logic for network errors)   │
        └─────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────┐
        │ Process Existing Files in Watch Folder  │
        └─────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────┐
        │ Start File Monitor                      │
        └─────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────┐
        │ Start Internet Monitoring Thread        │
        │ (Background, checks every 30s)          │
        └─────────────────────────────────────────┘
                              ↓
        ┌─────────────────────────────────────────┐
        │ APPLICATION RUNNING                     │
        │ Ready to process video files            │
        └─────────────────────────────────────────┘
```

## Video File Processing Flow

```
┌─────────────────────────────────────────────────────────────┐
│              NEW VIDEO FILE DETECTED                        │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│         Check if File is Ready (Not Being Written)          │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────┴───────┐
                    ↓               ↓
            ┌──────────────┐  ┌──────────────┐
            │   READY      │  │  NOT READY   │
            └──────────────┘  └──────────────┘
                    ↓               ↓
                    │          SKIP FILE
                    ↓
┌─────────────────────────────────────────────────────────────┐
│         Check Internet Connection Status                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────┴───────┐
                    ↓               ↓
            ┌──────────────┐  ┌──────────────┐
            │  INTERNET    │  │   NO INTERNET│
            │  AVAILABLE   │  │              │
            └──────────────┘  └──────────────┘
                    ↓               ↓
                    │         ┌─────────────────┐
                    │         │ Queue File      │
                    │         │ (In Memory)     │
                    │         └─────────────────┘
                    │               ↓
                    │         ┌─────────────────┐
                    │         │ Log: "Queueing" │
                    │         └─────────────────┘
                    │               ↓
                    │         ┌─────────────────┐
                    │         │ WAIT FOR        │
                    │         │ INTERNET        │
                    │         └─────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────────┐
│    Extract Timestamp from Filename                          │
│    (Format: YYYY-MM-DD_HH-MM-SS)                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│    Query Google Calendar for Meeting at That Time           │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────┴───────┐
                    ↓               ↓
            ┌──────────────┐  ┌──────────────┐
            │  MEETING     │  │   NO MEETING │
            │  FOUND       │  │   FOUND      │
            └──────────────┘  └──────────────┘
                    ↓               ↓
                    │         ┌─────────────────┐
                    │         │ Copy Original   │
                    │         │ File to Output  │
                    │         │ (Fallback)      │
                    │         └─────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────────┐
│    Generate New Filename with Meeting Title + Timestamp     │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              Rename File                                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│         Copy Renamed File to Output Folder                  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│      Delete Original File from Watch Folder                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│              PROCESSING COMPLETE ✓                          │
└─────────────────────────────────────────────────────────────┘
```

## Internet Monitoring Thread Flow

```
┌─────────────────────────────────────────────────────────────┐
│         INTERNET MONITORING THREAD STARTED                  │
│         (Runs in Background, Every 30 Seconds)              │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────────────────┐
                    │  LOOP (while app  │
                    │  is running)      │
                    └────────┬──────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │ Check Internet Connection              │
        │ (Try to connect to 8.8.8.8:53)         │
        └────────────────────────────────────────┘
                             ↓
                    ┌────────┴────────┐
                    ↓                 ↓
            ┌──────────────┐  ┌──────────────┐
            │  CONNECTED   │  │ DISCONNECTED │
            └──────────────┘  └──────────────┘
                    ↓                 ↓
        ┌──────────────────┐  ┌──────────────────┐
        │ Was offline?     │  │ Was online?      │
        └────────┬─────────┘  └────────┬─────────┘
                 ↓                     ↓
            ┌────────┐             ┌────────┐
            │  YES   │             │  YES   │
            └────┬───┘             └────┬───┘
                 ↓                     ↓
        ┌──────────────────┐  ┌──────────────────┐
        │ Log: "Internet   │  │ Log: "Internet   │
        │ connection       │  │ connection       │
        │ detected!"       │  │ lost!"           │
        │                  │  │                  │
        │ Set flag: ONLINE │  │ Set flag:        │
        │                  │  │ OFFLINE          │
        │ Process pending  │  │                  │
        │ files (if any)   │  │ (No action)      │
        └──────────────────┘  └──────────────────┘
                 ↓                     ↓
        ┌──────────────────────────────────────┐
        │ Sleep for 30 seconds                 │
        └──────────────────────────────────────┘
                             ↓
                    ┌────────────────────┐
                    │ Loop back to check  │
                    │ internet again      │
                    └────────────────────┘
```

## Pending Files Processing Flow

```
┌─────────────────────────────────────────────────────────────┐
│         INTERNET RESTORED (Detected by Monitor Thread)      │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│         Check if Pending Files Queue is Not Empty           │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────┴───────┐
                    ↓               ↓
            ┌──────────────┐  ┌──────────────┐
            │  FILES       │  │   NO FILES   │
            │  PENDING     │  │   PENDING    │
            └──────────────┘  └──────────────┘
                    ↓               ↓
                    │          CONTINUE
                    │          MONITORING
                    ↓
┌─────────────────────────────────────────────────────────────┐
│    Log: "Processing X pending file(s) from offline period"  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│         Copy Pending Files List                             │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│         Clear Pending Files Queue                           │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────────────────┐
                    │  FOR EACH FILE    │
                    │  IN PENDING LIST  │
                    └────────┬──────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │ Check if File Still Exists             │
        └────────────────────────────────────────┘
                             ↓
                    ┌────────┴────────┐
                    ↓                 ↓
            ┌──────────────┐  ┌──────────────┐
            │   EXISTS     │  │  DELETED     │
            └──────────────┘  └──────────────┘
                    ↓               ↓
                    │         Log: "File no
                    │         longer exists"
                    │               ↓
                    │         SKIP FILE
                    ↓
        ┌────────────────────────────────────────┐
        │ Process File (Rename with Meeting Title)│
        │ (Same as normal file processing)        │
        └────────────────────────────────────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │ Wait 1 Second Before Next File          │
        └────────────────────────────────────────┘
                             ↓
                    ┌────────────────────┐
                    │ More files?        │
                    └────────┬───────────┘
                             ↓
                    ┌────────┴────────┐
                    ↓                 ↓
                  YES               NO
                    ↓                 ↓
            ┌──────────────┐  ┌──────────────┐
            │ Loop to next │  │ All files    │
            │ file         │  │ processed    │
            └──────────────┘  └──────────────┘
                                     ↓
        ┌────────────────────────────────────────┐
        │ Log: "Finished processing pending files"│
        └────────────────────────────────────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │ Continue Normal Monitoring              │
        └────────────────────────────────────────┘
```

## State Diagram

```
                    ┌─────────────────┐
                    │   INITIALIZING  │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │ Check Internet? │
                    └────────┬────────┘
                             ↓
                    ┌────────┴────────┐
                    ↓                 ↓
            ┌──────────────┐  ┌──────────────┐
            │   ONLINE     │  │   OFFLINE    │
            │              │  │              │
            │ Authenticate │  │ Wait for     │
            │ with Google  │  │ Internet     │
            └──────────────┘  └──────────────┘
                    ↓                 ↓
                    │                 │
                    │         ┌───────┘
                    │         ↓
                    │    ┌──────────────┐
                    │    │   ONLINE     │
                    │    │              │
                    │    │ Authenticate │
                    │    │ with Google  │
                    │    └──────────────┘
                    │         ↓
                    └────────┬┘
                             ↓
                    ┌─────────────────┐
                    │   RUNNING       │
                    │                 │
                    │ Monitor Files   │
                    │ Monitor Internet│
                    └────────┬────────┘
                             ↓
                    ┌────────┴────────┐
                    ↓                 ↓
            ┌──────────────┐  ┌──────────────┐
            │   ONLINE     │  │   OFFLINE    │
            │              │  │              │
            │ Process Files│  │ Queue Files  │
            │ Immediately │  │ Wait for     │
            │              │  │ Internet     │
            └──────────────┘  └──────────────┘
                    ↑                 ↓
                    │         ┌───────┘
                    │         ↓
                    │    ┌──────────────┐
                    │    │   ONLINE     │
                    │    │              │
                    │    │ Process      │
                    │    │ Queued Files │
                    │    └──────────────┘
                    │         ↓
                    └─────────┘
```

## Summary

The offline mode implementation creates a robust system that:

1. **Detects** internet availability automatically
2. **Waits** for internet at startup if needed
3. **Queues** files when offline
4. **Monitors** connection status continuously
5. **Processes** queued files automatically when online
6. **Logs** all state changes for transparency

This ensures your application works reliably regardless of internet availability! 🚀

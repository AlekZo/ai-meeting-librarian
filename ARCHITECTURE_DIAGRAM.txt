╔════════════════════════════════════════════════════════════════════════════════╗
║                    НОВАЯ ДВУХЭТАПНАЯ АРХИТЕКТУРА                              ║
║                                                                                ║
║                    watch_folder → to_transcribe_folder                        ║
║                    (Переименование)  (Транскрипция)                           ║
╚════════════════════════════════════════════════════════════════════════════════╝


┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ЭТАП 1: ПЕРЕИМЕНОВАНИЕ                             │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────────────────────────────────┐
    │  watch_folder                                                    │
    │  ├─ Video_2026-01-26_20-30-03.mp4  ← Исходный файл             │
    │  └─ (Пользователь записывает видео)                            │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  FileMonitor (watch_folder)                                      │
    │  └─ on_video_created()                                           │
    │     ├─ Проверка готовности файла                               │
    │     ├─ Извлечение времени из имени                             │
    │     ├─ Поиск встречи в Google Calendar                         │
    │     └─ Переименование файла                                    │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  watch_folder                                                    │
    │  ├─ Front - Aorta weekly sync_2026-01-26_20-30-03.mp4 ← Новое  │
    │  └─ (Файл остается в папке)                                    │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Telegram Notification                                           │
    │  ✅ File renamed: Front - Aorta weekly sync_...                 │
    │  📝 Move it to the transcription folder to start transcription. │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌─────────────────────┐      ┌──────────────────────┐
        │ Пользователь        │      │ Пользователь         │
        │ переносит файл      │      │ удаляет файл         │
        │ в to_transcribe_    │      │ (не нужна            │
        │ folder              │      │ транскрипция)        │
        └─────────────────────┘      └──────────────────────┘
                    │
                    ▼


┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ЭТАП 2: ТРАНСКРИПЦИЯ                               │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────────────────────────────────┐
    │  to_transcribe_folder                                            │
    │  ├─ Front - Aorta weekly sync_2026-01-26_20-30-03.mp4 ← Файл   │
    │  └─ (Пользователь переносит сюда)                              │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  FileMonitor (to_transcribe_folder)                              │
    │  └─ on_video_for_transcription()                                │
    │     ├─ Проверка готовности файла                               │
    │     ├─ Извлечение информации из имени                          │
    │     ├─ Подготовка meeting_info                                 │
    │     └─ Загрузка на сервер                                      │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  VideoUploader._process_upload()                                 │
    │  ├─ POST /api/v1/transcription/upload-video                    │
    │  ├─ Получение job_id                                           │
    │  ├─ Перемещение файла в output_folder                          │
    │  └─ Запуск опроса статуса                                      │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  output_folder                                                   │
    │  ├─ Front - Aorta weekly sync_2026-01-26_20-30-03.mp4 ← Архив  │
    │  └─ (Файл перемещается сюда)                                   │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Telegram Notification                                           │
    │  📤 Starting transcription for: Front - Aorta weekly sync       │
    │  📤 Uploaded: Front - Aorta weekly sync_2026-01-26_20-30-03.mp4│
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Scriberr Server                                                 │
    │  ├─ Транскрипция видео                                         │
    │  ├─ Идентификация спикеров (AI)                                │
    │  └─ Подготовка результатов                                    │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Telegram Notification                                           │
    │  ✅ Transcription completed: Front - Aorta weekly sync_...      │
    │  🔍 Identifying speakers for: Front - Aorta weekly sync_...     │
    │  ✅ Speakers identified for: Front - Aorta weekly sync_...      │
    │                                                                  │
    │  Tap a speaker below to correct their name:                    │
    │  [Button: Speaker 1] [Button: Speaker 2] ...                   │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Пользователь редактирует спикеров (опционально)                │
    │  ├─ Переименовать спикера                                      │
    │  ├─ Поменять спикеров местами                                  │
    │  └─ Нажать "Done"                                              │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Финализация и публикация                                        │
    │  ├─ Загрузка в Google Drive                                    │
    │  ├─ Добавление в Google Sheets                                 │
    │  └─ Отправка ссылки в Telegram                                 │
    └──────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  Telegram Notification                                           │
    │  ✅ Finalizing transcript for Front - Aorta weekly sync_...     │
    │  ✅ Transcript finalized and published for Front - Aorta...     │
    │  📄 Transcript (Google Doc): https://docs.google.com/...        │
    └──────────────────────────────────────────────────────────────────┘


╔════════════════════════════════════════════════════════════════════════════════╗
║                            СОСТОЯНИЕ ПАПОК                                    ║
╚════════════════════════════════════════════════════════════════════════════════╝

ЭТАП 1: После записи видео
┌──────────────────────────────────────────────────────────────────────────────┐
│ watch_folder/                                                                │
│ └─ Video_2026-01-26_20-30-03.mp4                                            │
│                                                                              │
│ to_transcribe_folder/                                                       │
│ (пусто)                                                                     │
│                                                                              │
│ output_folder/                                                              │
│ (пусто)                                                                     │
└──────────────────────────────────────────────────────────────────────────────┘

ЭТАП 2: После переименования
┌──────────────────────────────────────────────────────────────────────────────┐
│ watch_folder/                                                                │
│ └─ Front - Aorta weekly sync_2026-01-26_20-30-03.mp4                        │
│                                                                              │
│ to_transcribe_folder/                                                       │
│ (пусто)                                                                     │
│                                                                              │
│ output_folder/                                                              │
│ (пусто)                                                                     │
└──────────────────────────────────────────────────────────────────────────────┘

ЭТАП 3: После переноса в to_transcribe_folder
┌──────────────────────────────────────────────────────────────────────────────┐
│ watch_folder/                                                                │
│ (пусто или другие файлы)                                                    │
│                                                                              │
│ to_transcribe_folder/                                                       │
│ └─ Front - Aorta weekly sync_2026-01-26_20-30-03.mp4                        │
│                                                                              │
│ output_folder/                                                              │
│ (пусто)                                                                     │
└──────────────────────────────────────────────────────────────────────────────┘

ЭТАП 4: После загрузки на сервер
┌──────────────────────────────────────────────────────────────────────────────┐
│ watch_folder/                                                                │
│ (пусто или другие файлы)                                                    │
│                                                                              │
│ to_transcribe_folder/                                                       │
│ (пусто)                                                                     │
│                                                                              │
│ output_folder/                                                              │
│ └─ Front - Aorta weekly sync_2026-01-26_20-30-03.mp4                        │
└──────────────────────────────────────────────────────────────────────────────┘


╔════════════════════════════════════════════════════════════════════════════════╗
║                         СРАВНЕНИЕ АРХИТЕКТУР                                  ║
╚════════════════════════════════════════════════════════════════════════════════╝

СТАРАЯ АРХИТЕКТУРА (одноэтапная)
┌──────────────────────────────────────────────────────────────────────────────┐
│ watch_folder                                                                 │
│ ├─ Видео появляется                                                         │
│ ├─ Переименование                                                           │
│ ├─ Копирование в output_folder                                             │
│ ├─ Загрузка на сервер                                                       │
│ ├─ Удаление из watch_folder                                                │
│ └─ Обработка транскрипции                                                  │
│    (все автоматически, пользователь не контролирует)                       │
└──────────────────────────────────────────────────────────────────────────────┘

НОВАЯ АРХИТЕКТУРА (двухэтапная)
┌──────────────────────────────────────────────────────────────────────────────┐
│ ЭТАП 1: watch_folder (Переименование)                                       │
│ ├─ Видео появляется                                                         │
│ ├─ Переименование                                                           │
│ └─ Файл остается (пользователь решает дальше)                              │
│                                                                              │
│ ЭТАП 2: to_transcribe_folder (Транскрипция)                                │
│ ├─ Пользователь переносит файл                                             │
│ ├─ Загрузка на сервер                                                       │
│ ├─ Перемещение в output_folder                                             │
│ └─ Обработка транскрипции                                                  │
│    (пользователь контролирует, какие файлы обрабатывать)                   │
└──────────────────────────────────────────────────────────────────────────────┘


╔════════════════════════════════════════════════════════════════════════════════╗
║                            ПРЕИМУЩЕСТВА                                        ║
╚════════════════════════════════════════════════════════════════════════════════╝

✅ Разделение ответственности
   - watch_folder: только переименование
   - to_transcribe_folder: только транскрипция

✅ Гибкость
   - Пользователь решает, какие файлы транскрибировать
   - Можно отредактировать имя перед транскрипцией

✅ Безопасность
   - Исходные файлы остаются в watch_folder
   - Обработанные файлы архивируются в output_folder

✅ Производительность
   - Два независимых монитора работают параллельно
   - Не блокируют друг друга

✅ Отладка
   - Проще отследить процесс
   - Логи содержат префиксы [WATCH_FOLDER] и [TO_TRANSCRIBE_FOLDER]
